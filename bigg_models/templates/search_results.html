{% extends "general_main.html" %}
{% import "general_table_macros.html" as tables %}
{% block head %}
<link href="https://cdn.datatables.net/v/bs5/jq-3.7.0/dt-2.3.4/r-3.0.7/datatables.min.css" rel="stylesheet"
	integrity="sha384-RqJtgepBGtU0p2QrKr7V6ktj9xhjmruqRUBkoNgZSdyNDI9FYHUwbaapY3jgsx7a" crossorigin="anonymous">
<script src="https://cdn.datatables.net/v/bs5/jq-3.7.0/dt-2.3.4/r-3.0.7/datatables.min.js"
	integrity="sha384-LFoikRctTHRCzOQ2ubrUfFQlhXMtaj7g32RRDMk2UVJFlHlk/s3w8xMOPB5t92MP" crossorigin="anonymous"></script>
<script src="/static/js/biggr_datatables.js"></script>
<script>
let report_search_count = function(table_id, recordsTotal) {
	if (recordsTotal === 0) {
		//$("#col-" + table_id).hide();
		$("#button-" + table_id).prop('disabled', true);
		if ($("#button-" + table_id).hasClass('active')) {
			let first_enabled = $('#search_tabs > li > button:not([disabled])').first();
			if (first_enabled.length === 0) {
				$('#no-results').removeClass('d-none');
				$('#search_row_container .tab-pane').hide();
				$('#search_tabs > li > button').removeClass('active');
			} else {
				bootstrap.Tab.getOrCreateInstance(first_enabled).show()
			}
		}
	}
	$("#button-badge-" + table_id).text(recordsTotal);
};

</script>
{% endblock %}
{% block body %}
<div class="row justify-content-center">
	<div class="col-12 col-lg-8 pt-lg-4 pb-lg-4 mb-2">
		<form class="d-flex" role="search" action="/search/" method="get">
			<div class="input-group"><input name="search_query"
					class="form-control border-1 border-primary" type="text"
				placeholder="Search" aria-label="Search" value="{{search_query}}"> <button
					class="btn btn-outline-primary" type="submit"><svg
						xmlns="http://www.w3.org/2000/svg" width="16"
						height="16" fill="currentColor" class="bi bi-search"
						viewBox="0 0 16 16">
						<path
							d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0" />
					</svg></button>
			</div>
		</form>
		{% include "search_modal.html" %}
	</div>

</div>
<div class="row" id="search_row_container">
	<div class="col-12 mb-4">
		<ul class="nav nav-tabs" id="search_tabs" role="tablist">
		{% for result_type in result_types %}
			<li class="nav-item" role="presentation">
				<button id="button-{{result_type.id}}_search" class="nav-link{% if loop.first %} active{% endif %}" data-bs-toggle="tab" data-bs-target="#tab-pane-{{result_type.id}}_search" type="button" role="tab" aria-controls="tab-pane-{{result_type.id}}_search" aria-selected="{% if loop.first %}true{% else %}false{% endif %}">{{ result_type.title }} <span class="badge text-bg-secondary" id="button-badge-{{result_type.id}}_search">...</span></button>
			</li>
	{% endfor %}
		</ul>
	</div>
	<div id="no-results" class="col-12 mb-2 d-none">
		<h5>No results for search query.</h5>
	</div>
	{% for result_type in result_types %}
	<div id="tab-pane-{{result_type.id}}_search" role="tabpanel" class="col-12 tab-pane fade {% if loop.first %}show active{% endif %}" aria-labelledby="button-{{result_type.id}}_search" tabindex="0">{% if result_type.message %}<div class="w-100"><p class="lead p-4">{{result_type.message}}</p></div>{% endif %}
			{{ tables.data_table(result_type.id ~ "_search", result_type.columns, result_type.data_url,
			result_type.row_icon, is_search=true, highlight=search_query) }}
		</div>
	{% endfor %}
</div>
<script>
const search_tabs = new bootstrap.Tab('#search_tabs')
</script>
{% endblock %}
