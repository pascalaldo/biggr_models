{% extends "general_main.html" %}
{% import "general_card_macros.html" as cards %}
{% block title %}BiGG Model {{model_bigg_id}}{% endblock %}
{% macro flush_model_download_item(filetype="sbml") %}
<li class="list-group-item">
	<div class="row g-0">
		<div class="col-6">
      <span class="align-middle">
      <svg class="me-2" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-arrow-down" viewBox="0 0 16 16">
  <path d="M8.5 6.5a.5.5 0 0 0-1 0v3.793L6.354 9.146a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 10.293z"/>
  <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
</svg>
                  Download model as {{filetype | upper}}</span>
		</div>
		<div class="col-6">
                  <div class="btn-group row g-0 w-100" role="group" aria-label="Model download">
        <a type="button" class="btn btn-outline-primary btn-sm col-6" href="/static/models/models/{{model_bigg_id}}.biggr.{{filetype}}">.{{filetype}}</a>
        <a type="button" class="btn btn-outline-primary btn-sm col-6" href="/static/models/models/{{model_bigg_id}}.biggr.{{filetype}}.gz">.{{filetype}}.gz</a>
      </div>
		</div>
  </div>
</li>
{% endmacro %}
{% block body %}
<div class="row">
  <div class="col-md-6">
    {% call cards.item_card("model_L", "Model", True) %}
          <div class="card-body">
            <h5 class="card-title">{{model_bigg_id}}</h5>
            <p class="card-text">{{organism}}</p>
          </div>
          {% call cards.flush_list_group(accent=True) %}
          {% if genome_name is none %}
            {{ cards.flush_list_group_item(value='Model is not mapped to a genome', accent=True) }}
          {% else %}
            {{ cards.flush_list_group_item(label="Genome", value=genome_name, link="/genomes/"~genome_ref_string, accent=True) }}
          {% endif %}
            {% if reference_type == 'pmid' %}
              {{ cards.flush_list_group_item(label="Publication PMID", value=reference_id, link="https://www.ncbi.nlm.nih.gov/pubmed/"~reference_id, accent=True) }}
            {% elif reference_type == 'doi' %}
              {{ cards.flush_list_group_item(label="Publication DOI", value=reference_id, link="https://dx.doi.org/"~reference_id, accent=True) }}
            {% endif %}
          {% endcall %}
    {% endcall %}
  </div>

  <div class="col-md-6">
    <div class="card mb-3">
      <div class="card-header">
        <h5 class="card-title">Model Metrics</h5>
      </div>
        {{ cards.flush_list_group(model_metrics, align=6) }}
    </div>
  </div>
  <div class="col-md-6">
    <div class="card mb-3">
      <div class="card-header">
        <h5 class="card-title">Download</h5>
      </div>
      <ul class="list-group list-group-flush">
        {{ flush_model_download_item(filetype='sbml') }}
        {{ flush_model_download_item(filetype='json') }}
        {{ flush_model_download_item(filetype='yaml') }}
      </ul>
      <div class="card-footer">
<small>Last updated: <span class="text-primary-emphasis">{{ model_modified_date }}</span></small>
      </div>
    </div>
  </div>

  {% if memote_general_result is not none %}
  <div class="col-md-6">
    <div class="card mb-3">
      <div class="card-header">
        <h5 class="card-title">MEMOTE Overview</h5>
      </div>
      <div class="accordion accordion-flush" id="memote_overview_accordion">
        {% for test_id, (test_data, result_data) in memote_general_result.items() %}

            {% if result_data.result == "passed" %}{% set icon -%}
          <span class="me-2 text-success"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-square" viewBox="0 0 16 16">
            <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
            <path d="M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425z"/>
          </svg></span>
        {%- endset %}{% elif result_data.result == "failed" %}{% set icon -%}
          <span class="me-2 text-danger"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-diamond" viewBox="0 0 16 16">
            <path d="M6.95.435c.58-.58 1.52-.58 2.1 0l6.515 6.516c.58.58.58 1.519 0 2.098L9.05 15.565c-.58.58-1.519.58-2.098 0L.435 9.05a1.48 1.48 0 0 1 0-2.098zm1.4.7a.495.495 0 0 0-.7 0L1.134 7.65a.495.495 0 0 0 0 .7l6.516 6.516a.495.495 0 0 0 .7 0l6.516-6.516a.495.495 0 0 0 0-.7L8.35 1.134z"/>
            <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
          </svg></span>
        {%- endset %}{% else %}{% set icon -%}
          <span class="me-2 text-warning"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-patch-question" viewBox="0 0 16 16">
            <path d="M8.05 9.6c.336 0 .504-.24.554-.627.04-.534.198-.815.847-1.26.673-.475 1.049-1.09 1.049-1.986 0-1.325-.92-2.227-2.262-2.227-1.02 0-1.792.492-2.1 1.29A1.7 1.7 0 0 0 6 5.48c0 .393.203.64.545.64.272 0 .455-.147.564-.51.158-.592.525-.915 1.074-.915.61 0 1.03.446 1.03 1.084 0 .563-.208.885-.822 1.325-.619.433-.926.914-.926 1.64v.111c0 .428.208.745.585.745"/>
            <path d="m10.273 2.513-.921-.944.715-.698.622.637.89-.011a2.89 2.89 0 0 1 2.924 2.924l-.01.89.636.622a2.89 2.89 0 0 1 0 4.134l-.637.622.011.89a2.89 2.89 0 0 1-2.924 2.924l-.89-.01-.622.636a2.89 2.89 0 0 1-4.134 0l-.622-.637-.89.011a2.89 2.89 0 0 1-2.924-2.924l.01-.89-.636-.622a2.89 2.89 0 0 1 0-4.134l.637-.622-.011-.89a2.89 2.89 0 0 1 2.924-2.924l.89.01.622-.636a2.89 2.89 0 0 1 4.134 0l-.715.698a1.89 1.89 0 0 0-2.704 0l-.92.944-1.32-.016a1.89 1.89 0 0 0-1.911 1.912l.016 1.318-.944.921a1.89 1.89 0 0 0 0 2.704l.944.92-.016 1.32a1.89 1.89 0 0 0 1.912 1.911l1.318-.016.921.944a1.89 1.89 0 0 0 2.704 0l.92-.944 1.32.016a1.89 1.89 0 0 0 1.911-1.912l-.016-1.318.944-.921a1.89 1.89 0 0 0 0-2.704l-.944-.92.016-1.32a1.89 1.89 0 0 0-1.912-1.911z"/>
            <path d="M7.001 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0"/>
          </svg></span>
        {%- endset %}{% endif%}

        <div class="accordion-item">
          <h5 class="accordion-header" id="flush-heading-{{test_id}}">
            <button class="accordion-button collapsed p-2" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse-{{test_id}}" aria-expanded="false" aria-controls="flush-collapseOne">{{icon}} {{test_data.name}}</button>
          </h5>
          <div id="flush-collapse-{{test_id}}" class="accordion-collapse collapse" aria-labelledby="flush-heading-{{test_id}}" data-bs-parent="#memote_overview_accordion">
<div class="accordion-body">{% if result_data.message is not none %}<p>{{result_data.message}}</p>{% else %}{% set no_message = True %}{% endif %}{% if test_data.summary is not none %}<p class="small">{{test_data.summary}}</p>{% elif no_message %}<p><i>No further information available.</i></p>{% endif %}</div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endif %}

</div>
{% endblock %}
